<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MOS Evaluation</title>

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 1100px;
  margin: auto;
}

.stimulus {
  margin-bottom: 50px;
  padding-bottom: 30px;
  border-bottom: 1px solid #ccc;
}

label {
  display: block;
  margin: 4px 0;
}

button {
  font-size: 16px;
  padding: 12px 30px;
  margin: 30px 0;
}
</style>
</head>

<body>

<h2>MOS Evaluation #2</h2>
<p>
ë³¸ ì‹¤í—˜ì€ ì˜ìƒì„ ì‹œì²­í•œ í›„, <b>ì˜ìƒì— í‘œì‹œëœ ê·¸ë˜í”„ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¬ìƒë˜ëŠ” ì˜¤ë””ì˜¤ì˜ íƒ€ì´ë°ì´ ì–¼ë§ˆë‚˜ ì˜ ë§ëŠ”ì§€</b>ë¥¼ 1ì ë¶€í„° 5ì ê¹Œì§€ í‰ê°€í•˜ëŠ” ì‹¤í—˜ì…ë‹ˆë‹¤.
</p>
<p>
ê° ìƒ˜í”Œì€ ì„œë¡œ ë¹„êµí•˜ì§€ ë§ê³ , í•´ë‹¹ ì˜¤ë””ì˜¤ ìƒ˜í”Œì˜ íƒ€ì´ë° ì¼ì¹˜ ì •ë„ë§Œì„ ê¸°ì¤€ìœ¼ë¡œ <b>ì ˆëŒ€ì ì¸ ì ìˆ˜</b>ë¥¼ ë¶€ì—¬í•´ ì£¼ì„¸ìš”.
</p>
<p>
â€» ì˜¤ë””ì˜¤ì˜ ìŒì§ˆì´ë‚˜ ìì—°ìŠ¤ëŸ¬ì›€ì€ í‰ê°€ ê¸°ì¤€ì´ ì•„ë‹™ë‹ˆë‹¤. <b>ì†Œë¦¬ì˜ ë“±ì¥ê³¼ ì‚¬ë¼ì§ì´ ê·¸ë˜í”„ì™€ ì‹œê°„ì ìœ¼ë¡œ ì˜ ë§ëŠ”ì§€</b>ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ í‰ê°€í•´ ì£¼ì„¸ìš”.
</p>
<p>
â€» ê° ì˜ìƒì€ <b>0ì´ˆë¶€í„° 10ì´ˆê¹Œì§€ ì „ì²´ë¥¼ ì‹œì²­í•œ í›„</b> í‰ê°€í•´ ì£¼ì„¸ìš”.
</p>

<p><b>í‰ê°€ ê¸°ì¤€</b></p>
<ul>
  <li>5 (Excellent): ì˜¤ë””ì˜¤ì˜ íƒ€ì´ë°ì´ ê·¸ë˜í”„ì™€ ì™„ì „íˆ ì¼ì¹˜í•¨</li>
  <li>4 (Good): ì¼ë¶€ ì–´ê¸‹ë‚˜ëŠ” ë¶€ë¶„ì´ ìˆìœ¼ë‚˜ ì „ë°˜ì ìœ¼ë¡œ ì˜ ë§ìŒ</li>
  <li>3 (Fair): ì–´ê¸‹ë‚˜ëŠ” ë¶€ë¶„ì´ ì¢…ì¢… ë‚˜íƒ€ë‚˜ë‚˜ ëŒ€ì²´ë¡œ ë§ëŠ” í¸ì„</li>
  <li>2 (Poor): ì–´ê¸‹ë‚˜ëŠ” ë¶€ë¶„ì´ ìì£¼ ë‚˜íƒ€ë‚¨</li>
  <li>1 (Bad): íƒ€ì´ë°ì´ ê±°ì˜ ë§ì§€ ì•ŠìŒ</li>
</ul>

<p>
âš ï¸ ì‹¤í—˜ì´ ì¢…ë£Œë˜ë©´ <b>ê²°ê³¼ íŒŒì¼ì´ ìë™ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ</b>ë©ë‹ˆë‹¤. ì‹¤í—˜ ë„ì¤‘ ë¸Œë¼ìš°ì €ë¥¼ ë‹«ì§€ ì•Šë„ë¡ ì£¼ì˜í•´ ì£¼ì„¸ìš”.
</p>
<p>
ğŸ§ ì¡°ìš©í•œ í™˜ê²½ì—ì„œ <b>í—¤ë“œí° ì‚¬ìš©</b>ì„ ê¶Œì¥í•˜ë©°, ê°€ëŠ¥í•œ í•œ ì¢‹ì€ ìŒí–¥ ì¥ë¹„ë¥¼ ì‚¬ìš©í•´ ì£¼ì„¸ìš”.  
ë‹¨, íƒ€ì´ë° í‰ê°€ ì‹¤í—˜ì´ë¯€ë¡œ <b>ë¸”ë£¨íˆ¬ìŠ¤ í—¤ë“œí°/ì´ì–´í°ì€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.</b>
</p>
<p>
ì´ 80 ìƒ˜í”Œë¡œ, ì•½ 30ë¶„ ì •ë„ ì†Œìš”ë©ë‹ˆë‹¤. 
</p>

<div id="container"></div>

<button id="nextBtn">Next</button>

<script>
/********************************************************
 * CONFIGURATION
 ********************************************************/

const ITEMS_PER_PAGE = 5;

/* FIXED SYNTAX (commas added) */
const stimuli = [
  { id: "v01", file: "./samples/video/0_ts/v_00.mp4" },
  { id: "v02", file: "./samples/video/0_ts/v_01.mp4" },
  { id: "v03", file: "./samples/video/0_ts/v_02.mp4" },
  { id: "v04", file: "./samples/video/0_ts/v_03.mp4" },
  { id: "v05", file: "./samples/video/0_ts/v_04.mp4" },
  { id: "v06", file: "./samples/video/0_ts/v_05.mp4" },
  { id: "v07", file: "./samples/video/0_ts/v_06.mp4" },
  { id: "v08", file: "./samples/video/0_ts/v_07.mp4" },
  { id: "v09", file: "./samples/video/0_ts/v_08.mp4" },
  { id: "v10", file: "./samples/video/0_ts/v_09.mp4" },
  { id: "v11", file: "./samples/video/0_ts/v_10.mp4" },
  { id: "v12", file: "./samples/video/0_ts/v_11.mp4" },
  { id: "v13", file: "./samples/video/0_ts/v_12.mp4" },
  { id: "v14", file: "./samples/video/0_ts/v_13.mp4" },
  { id: "v15", file: "./samples/video/0_ts/v_14.mp4" },
  { id: "v16", file: "./samples/video/0_ts/v_15.mp4" },
  { id: "v17", file: "./samples/video/0_ts/v_16.mp4" },
  { id: "v18", file: "./samples/video/0_ts/v_17.mp4" },
  { id: "v19", file: "./samples/video/0_ts/v_18.mp4" },
  { id: "v20", file: "./samples/video/0_ts/v_19.mp4" },
  { id: "v21", file: "./samples/video/1_rms/v_00.mp4" },
  { id: "v22", file: "./samples/video/1_rms/v_01.mp4" },
  { id: "v23", file: "./samples/video/1_rms/v_02.mp4" },
  { id: "v24", file: "./samples/video/1_rms/v_03.mp4" },
  { id: "v25", file: "./samples/video/1_rms/v_04.mp4" },
  { id: "v26", file: "./samples/video/1_rms/v_05.mp4" },
  { id: "v27", file: "./samples/video/1_rms/v_06.mp4" },
  { id: "v28", file: "./samples/video/1_rms/v_07.mp4" },
  { id: "v29", file: "./samples/video/1_rms/v_08.mp4" },
  { id: "v30", file: "./samples/video/1_rms/v_09.mp4" },
  { id: "v31", file: "./samples/video/1_rms/v_10.mp4" },
  { id: "v32", file: "./samples/video/1_rms/v_11.mp4" },
  { id: "v33", file: "./samples/video/1_rms/v_12.mp4" },
  { id: "v34", file: "./samples/video/1_rms/v_13.mp4" },
  { id: "v35", file: "./samples/video/1_rms/v_14.mp4" },
  { id: "v36", file: "./samples/video/1_rms/v_15.mp4" },
  { id: "v37", file: "./samples/video/1_rms/v_16.mp4" },
  { id: "v38", file: "./samples/video/1_rms/v_17.mp4" },
  { id: "v39", file: "./samples/video/1_rms/v_18.mp4" },
  { id: "v40", file: "./samples/video/1_rms/v_19.mp4" },
  { id: "v41", file: "./samples/video/2_em/v_00.mp4" },
  { id: "v42", file: "./samples/video/2_em/v_01.mp4" },
  { id: "v43", file: "./samples/video/2_em/v_02.mp4" },
  { id: "v44", file: "./samples/video/2_em/v_03.mp4" },
  { id: "v45", file: "./samples/video/2_em/v_04.mp4" },
  { id: "v46", file: "./samples/video/2_em/v_05.mp4" },
  { id: "v47", file: "./samples/video/2_em/v_06.mp4" },
  { id: "v48", file: "./samples/video/2_em/v_07.mp4" },
  { id: "v49", file: "./samples/video/2_em/v_08.mp4" },
  { id: "v50", file: "./samples/video/2_em/v_09.mp4" },
  { id: "v51", file: "./samples/video/2_em/v_10.mp4" },
  { id: "v52", file: "./samples/video/2_em/v_11.mp4" },
  { id: "v53", file: "./samples/video/2_em/v_12.mp4" },
  { id: "v54", file: "./samples/video/2_em/v_13.mp4" },
  { id: "v55", file: "./samples/video/2_em/v_14.mp4" },
  { id: "v56", file: "./samples/video/2_em/v_15.mp4" },
  { id: "v57", file: "./samples/video/2_em/v_16.mp4" },
  { id: "v58", file: "./samples/video/2_em/v_17.mp4" },
  { id: "v59", file: "./samples/video/2_em/v_18.mp4" },
  { id: "v60", file: "./samples/video/2_em/v_19.mp4" },
  { id: "v61", file: "./samples/video/3_ts_em/v_00.mp4" },
  { id: "v62", file: "./samples/video/3_ts_em/v_01.mp4" },
  { id: "v63", file: "./samples/video/3_ts_em/v_02.mp4" },
  { id: "v64", file: "./samples/video/3_ts_em/v_03.mp4" },
  { id: "v65", file: "./samples/video/3_ts_em/v_04.mp4" },
  { id: "v66", file: "./samples/video/3_ts_em/v_05.mp4" },
  { id: "v67", file: "./samples/video/3_ts_em/v_06.mp4" },
  { id: "v68", file: "./samples/video/3_ts_em/v_07.mp4" },
  { id: "v69", file: "./samples/video/3_ts_em/v_08.mp4" },
  { id: "v70", file: "./samples/video/3_ts_em/v_09.mp4" },
  { id: "v71", file: "./samples/video/3_ts_em/v_10.mp4" },
  { id: "v72", file: "./samples/video/3_ts_em/v_11.mp4" },
  { id: "v73", file: "./samples/video/3_ts_em/v_12.mp4" },
  { id: "v74", file: "./samples/video/3_ts_em/v_13.mp4" },
  { id: "v75", file: "./samples/video/3_ts_em/v_14.mp4" },
  { id: "v76", file: "./samples/video/3_ts_em/v_15.mp4" },
  { id: "v77", file: "./samples/video/3_ts_em/v_16.mp4" },
  { id: "v78", file: "./samples/video/3_ts_em/v_17.mp4" },
  { id: "v79", file: "./samples/video/3_ts_em/v_18.mp4" },
  { id: "v80", file: "./samples/video/3_ts_em/v_19.mp4" },
];

/********************************************************
 * VARIABLES
 ********************************************************/

let trials = [];
let pageIndex = 0;
let results = [];

/********************************************************
 * FUNCTIONS
 ********************************************************/

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

/* participant-wise randomization */
if (sessionStorage.getItem("mos_trials")) {
  trials = JSON.parse(sessionStorage.getItem("mos_trials"));
} else {
  trials = stimuli.slice();
  shuffle(trials);
  sessionStorage.setItem("mos_trials", JSON.stringify(trials));
}

function loadPage() {
  const container = document.getElementById("container");
  container.innerHTML = "";

  const start = pageIndex * ITEMS_PER_PAGE;
  const current = trials.slice(start, start + ITEMS_PER_PAGE);

  current.forEach((t, idx) => {

    const block = document.createElement("div");
    block.className = "stimulus";

    const title = document.createElement("h4");
    title.textContent = `Item ${start + idx + 1}`;
    block.appendChild(title);

    /* video */
    const video = document.createElement("video");
    video.width = 900;
    video.controls = true;

    const source = document.createElement("source");
    source.src = t.file;
    source.type = "video/mp4";

    video.appendChild(source);
    block.appendChild(video);

    /* MOS */
    const q = document.createElement("p");
    q.innerHTML = "<b>Timing quality:</b>";
    block.appendChild(q);

    for (let score = 5; score >= 1; score--) {
      const label = document.createElement("label");

      const input = document.createElement("input");
      input.type = "radio";
      input.name = "mos_" + t.id;
      input.value = score;

      label.appendChild(input);
      label.appendChild(document.createTextNode(" " + score));

      block.appendChild(label);
    }

    container.appendChild(block);
  });
}

/********************************************************
 * NEXT BUTTON
 ********************************************************/

document.getElementById("nextBtn").onclick = function () {

  const start = pageIndex * ITEMS_PER_PAGE;
  const current = trials.slice(start, start + ITEMS_PER_PAGE);

  for (const t of current) {
    const selected = document.querySelector(
      `input[name="mos_${t.id}"]:checked`
    );

    if (!selected) {
      alert("Please rate all videos on this page.");
      return;
    }

    results.push({
      stimulus: t.id,
      mos: selected.value,
      page: pageIndex + 1
    });
  }

  pageIndex++;

  if (pageIndex * ITEMS_PER_PAGE < trials.length) {
    loadPage();
  } else {
    finish();
  }
};

/********************************************************
 * FINISH & DOWNLOAD
 ********************************************************/

function finish() {
  let csv = "stimulus,mos,page\n";

  results.forEach(r => {
    csv += `${r.stimulus},${r.mos},${r.page}\n`;
  });

  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "mos_results.csv";
  a.click();

  document.body.innerHTML = "<h2>Thank you for your participation.</h2>";
}

loadPage();
</script>

</body>
</html>
